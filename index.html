<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ronash Key System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0; padding: 0; background-color: #0d0d12; color: #e0e0e0;
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
        }
        .bg-mountain {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(at 50% 100%, #1a1a2e 0%, #0d0d12 100%), linear-gradient(180deg, rgba(30, 30, 45, 0.6) 0%, rgba(13, 13, 18, 1) 100%);
        }
        .text-accent-green { color: #50fa7b; }
        .bg-dark-panel { background-color: rgba(22, 22, 33, 0.9); }
        .key-row-grid {
            display: grid; grid-template-columns: 2fr 1.5fr 1fr 1.5fr; gap: 0.5rem; align-items: center;
        }
        @media (max-width: 640px) {
            .key-row-grid { grid-template-columns: 1fr; gap: 0.25rem; }
            .key-header-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="p-4 sm:p-6">
    <div class="bg-mountain"></div>

    <header class="w-full max-w-2xl bg-dark-panel shadow-2xl rounded-xl mb-4">
        <div class="flex justify-between items-center p-4">
            <div class="text-xl font-bold text-accent-green">Ronash</div>
            <button id="main-progress-btn" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white font-semibold text-sm rounded-lg transition duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                START
            </button>
        </div>
    </header>

    <main class="w-full max-w-2xl bg-dark-panel rounded-xl shadow-2xl overflow-hidden">
        <div class="p-4 border-b border-gray-800">
            <h2 class="text-lg font-semibold text-white">Ronash Key System</h2>
        </div>

        <div class="p-4 border-b border-gray-800 flex flex-col sm:flex-row justify-between items-start sm:items-center">
            <div class="text-sm font-medium text-gray-400 mb-2 sm:mb-0">
                Progress: <span id="progress-text" class="text-white font-bold">0/2</span>
            </div>
            <div class="w-full sm:w-1/2">
                <div class="h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-2 bg-accent-green transition-all duration-500" style="width: 0%;"></div>
                </div>
            </div>
        </div>

        <div class="p-4 bg-gray-900 border-b border-gray-700">
            <p id="instruction-area" class="text-sm text-gray-300 italic">
                Start the key retrieval process by clicking the START button.
            </p>
        </div>

        <div class="hidden sm:grid p-4 key-row-grid text-xs font-semibold uppercase text-gray-400 bg-gray-900 key-header-grid">
            <div>KEY STATUS</div>
            <div>TIME LEFT</div>
            <div>VALIDATION</div>
            <div>ACTIONS</div>
        </div>

        <div class="p-4 key-row-grid border-t border-gray-800">
            <div class="flex flex-col">
                <span class="sm:hidden text-xs uppercase font-semibold text-gray-400">KEY STATUS</span>
                <span id="key-status-display" class="font-mono text-sm break-all text-red-400">LOCKED</span>
            </div>
            <div class="flex flex-col">
                <span class="sm:hidden text-xs uppercase font-semibold text-gray-400">TIME LEFT</span>
                <span id="key-time-display" class="text-sm text-gray-300">N/A</span>
            </div>
            <div class="flex flex-col">
                <span class="sm:hidden text-xs uppercase font-semibold text-gray-400">VALIDATION</span>
                <span id="key-validation-display" class="text-sm text-red-500 font-bold">INVALID</span>
            </div>
            <div class="flex flex-col">
                <span class="sm:hidden text-xs uppercase font-semibold text-gray-400">ACTIONS</span>
                <button id="action-btn" class="w-full px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold text-xs rounded-lg transition duration-200 shadow-md">
                    + GET UNLI KEY
                </button>
            </div>
        </div>
    </main>

    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center p-4 z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-2xl max-w-sm w-full border border-indigo-500">
            <h3 id="modal-title" class="text-lg font-bold text-accent-green mb-3">Notice</h3>
            <p id="modal-message" class="text-sm text-gray-200 mb-4"></p>
            <button id="modal-close-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg font-semibold">Close</button>
        </div>
    </div>

    <script>
        const showMessage = (title, message) => {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('message-modal').classList.remove('hidden');
            document.getElementById('message-modal').classList.add('flex');
        };
        document.getElementById('modal-close-btn').addEventListener('click', () => {
            document.getElementById('message-modal').classList.remove('flex');
            document.getElementById('message-modal').classList.add('hidden');
        });
        const copyToClipboard = (text) => {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                const successful = document.execCommand('copy');
                showMessage('Success!', successful ? 'Key copied to clipboard!' : 'Failed to copy key. Please copy manually.');
            } catch (err) {
                showMessage('Error', 'Failed to copy key. Please copy manually.');
            }
            document.body.removeChild(textarea);
        };

        const STORAGE_KEY = 'ronashKeyProgress';
        const EXPIRATION_DURATION_MS = 24 * 60 * 60 * 1000;

        const CHECKPOINTS = [
            // Index 0 (currentProgress = 0) -> Opens Linkvertise, then advances to 1
            { id: 1, name: "Linkvertise", url: "https://link-target.net/1424046/HPxPeiwfkobC" },
            // Index 1 (currentProgress = 1) -> Opens Work.ink, then advances to 2
            { id: 2, name: "Work.ink", url: "https://workink.net/23PZ/Ronash%20hub" }
        ];

        let state = { currentProgress: 0, acquiredKey: null, keyExpiryTime: null, intervalId: null };
        
        const $progressText = document.getElementById('progress-text');
        const $progressBar = document.getElementById('progress-bar');
        const $instructionArea = document.getElementById('instruction-area');
        const $mainProgressBtn = document.getElementById('main-progress-btn');
        const $actionBtn = document.getElementById('action-btn');
        const $keyStatusDisplay = document.getElementById('key-status-display');
        const $keyTimeDisplay = document.getElementById('key-time-display');
        const $keyValidationDisplay = document.getElementById('key-validation-display');

        const saveState = () => {
            sessionStorage.setItem(STORAGE_KEY, JSON.stringify({
                currentProgress: state.currentProgress, acquiredKey: state.acquiredKey, keyExpiryTime: state.keyExpiryTime
            }));
        };
        const loadState = () => {
            const savedState = sessionStorage.getItem(STORAGE_KEY);
            if (savedState) {
                try {
                    const loaded = JSON.parse(savedState);
                    state.currentProgress = loaded.currentProgress || 0;
                    state.acquiredKey = loaded.acquiredKey || null;
                    state.keyExpiryTime = loaded.keyExpiryTime || null;
                } catch (e) { resetKeySystem(); }
            }
        };

        const generateMockKey = () => {
            const randomChunk = () => Math.random().toString(36).substring(2, 7).toUpperCase();
            return `LUARMOR-RN_${randomChunk()}-${randomChunk()}-${randomChunk()}`;
        };

        const resetKeySystem = (showAlert = false) => {
            state.currentProgress = 0; state.acquiredKey = null; state.keyExpiryTime = null;
            if (state.intervalId) { clearInterval(state.intervalId); state.intervalId = null; }
            saveState(); updateUI();
            if (showAlert) { showMessage('Key Expired', 'Your 24-hour key has expired. Please restart the process to get a new one.'); }
        };

        const updateCountdown = () => {
            if (!state.keyExpiryTime || state.currentProgress !== 3) {
                if (state.intervalId) clearInterval(state.intervalId);
                return;
            }
            const timeRemainingMs = state.keyExpiryTime - Date.now();
            if (timeRemainingMs <= 0) { resetKeySystem(true); return; }

            const totalSeconds = Math.floor(timeRemainingMs / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            const format = (unit) => String(unit).padStart(2, '0');

            $keyTimeDisplay.textContent = `${format(hours)}:${format(minutes)}:${format(seconds)}`;
        };

        const startCountdown = () => {
            if (state.intervalId) { clearInterval(state.intervalId); }
            if (state.keyExpiryTime && state.keyExpiryTime > Date.now()) {
                state.intervalId = setInterval(updateCountdown, 1000);
                updateCountdown();
            } else if (state.keyExpiryTime && state.keyExpiryTime <= Date.now()) {
                resetKeySystem(false);
            }
        };

        const updateUI = () => {
            // State 3: Key is Active and Valid (No progress advancing button needed)
            if (state.acquiredKey && state.keyExpiryTime && state.keyExpiryTime > Date.now()) {
                state.currentProgress = 3; 

                $progressText.textContent = '2/2'; $progressBar.style.width = '100%';
                
                // Button is disabled when key is active/validated
                $mainProgressBtn.textContent = 'KEY VALIDATED'; 
                $mainProgressBtn.disabled = true;

                $instructionArea.innerHTML = '✅ Key is **VALID**. Use the copy key button below. Timer is running!';
                $instructionArea.classList.add('text-accent-green'); $instructionArea.classList.remove('text-gray-300');

                $keyStatusDisplay.textContent = state.acquiredKey;
                $keyStatusDisplay.classList.remove('text-red-400'); $keyStatusDisplay.classList.add('text-white');

                $keyValidationDisplay.textContent = 'VALID';
                $keyValidationDisplay.classList.remove('text-red-500'); $keyValidationDisplay.classList.add('text-accent-green');

                $actionBtn.textContent = 'COPY KEY';
                $actionBtn.onclick = () => copyToClipboard(state.acquiredKey);
                $actionBtn.disabled = false;
                $actionBtn.classList.add('bg-accent-green', 'hover:bg-green-700');
                $actionBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');

                startCountdown();
                return;
            }

            // State 0, 1, 2: Checkpoint Process
            let nextAction;
            let currentCheckpoint = CHECKPOINTS[state.currentProgress];

            if (state.currentProgress === 0) {
                // START button -> Linkvertise
                $progressText.textContent = '0/2'; $progressBar.style.width = '0%';
                $mainProgressBtn.textContent = 'START'; $mainProgressBtn.disabled = false;
                $instructionArea.textContent = `Start the key retrieval process by clicking START. (Opens ${currentCheckpoint.name}).`;
                nextAction = `+ VISIT ${currentCheckpoint.name}`;
            } else if (state.currentProgress === 1) {
                // NEXT CHECKPOINT button -> Work.ink
                $progressText.textContent = '1/2'; $progressBar.style.width = '50%';
                $mainProgressBtn.textContent = 'NEXT CHECKPOINT'; $mainProgressBtn.disabled = false;
                $instructionArea.textContent = `Checkpoint 1 completed. Click NEXT CHECKPOINT to proceed. (Opens ${currentCheckpoint.name}).`;
                nextAction = `+ VISIT ${currentCheckpoint.name}`;
            } else if (state.currentProgress === 2) {
                // FINISHED state
                $progressText.textContent = '2/2'; $progressBar.style.width = '100%';
                $mainProgressBtn.textContent = 'FINISHED'; $mainProgressBtn.disabled = true;
                $instructionArea.textContent = 'All checkpoints complete! Click GET THE KEY in the Actions column below.';
                nextAction = 'GET THE KEY';
                currentCheckpoint = null;
            } else {
                 state.currentProgress = 0; updateUI(); return;
            }

            // Reset non-active key UI elements
            $instructionArea.classList.remove('text-accent-green'); $instructionArea.classList.add('text-gray-300');
            $keyStatusDisplay.textContent = 'LOCKED'; $keyStatusDisplay.classList.add('text-red-400'); $keyStatusDisplay.classList.remove('text-white');
            $keyTimeDisplay.textContent = 'N/A';
            $keyValidationDisplay.textContent = 'INVALID'; $keyValidationDisplay.classList.add('text-red-500'); $keyValidationDisplay.classList.remove('text-accent-green');
            $actionBtn.textContent = nextAction;
            $actionBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700'); $actionBtn.classList.remove('bg-accent-green', 'hover:bg-green-700');
            $actionBtn.disabled = false;

            // Header Button Logic (Opens link for the CURRENT state, AND advances state)
            $mainProgressBtn.onclick = () => {
                if (state.currentProgress < 2) {
                    const nextCheckpoint = CHECKPOINTS[state.currentProgress];
                    window.open(nextCheckpoint.url, '_blank');
                    state.currentProgress++; // Advance progress to the next checkpoint state
                    saveState();
                    updateUI();
                }
            };

            // Table Button Logic (Opens link OR gets key)
            $actionBtn.onclick = () => {
                if (state.currentProgress < 2 && currentCheckpoint) {
                    // Open the link for the current checkpoint without advancing progress
                    window.open(currentCheckpoint.url, '_blank');
                } else if (state.currentProgress === 2) {
                    // Final step: GET THE KEY (one-time generation)
                    state.acquiredKey = generateMockKey();
                    state.keyExpiryTime = Date.now() + EXPIRATION_DURATION_MS;
                    saveState();
                    updateUI();
                    showMessage('Key Acquired!', 'Your 24-hour key has been successfully generated!');
                }
            };
        };

        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            updateUI();
        });
    </script>
</body>
</html>

